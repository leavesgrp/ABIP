\hypertarget{cs__counts_8c_source}{}\doxysection{cs\+\_\+counts.\+c}
\label{cs__counts_8c_source}\index{csparse/Source/cs\_counts.c@{csparse/Source/cs\_counts.c}}
\mbox{\hyperlink{cs__counts_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{cs_8h}{cs.h}}"{}}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00002}00002 \textcolor{comment}{/* column counts of LL'=A or LL'=A'A, given parent \& post ordering */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00003}\mbox{\hyperlink{cs__counts_8c_a12ca900356d8c2b441db5f1077dee0e8}{00003}} \textcolor{preprocessor}{\#define HEAD(k,j) (ata ? head [k] : j)}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00004}\mbox{\hyperlink{cs__counts_8c_a5638f1bcf2b9b270aa560e0ec861b133}{00004}} \textcolor{preprocessor}{\#define NEXT(J)   (ata ? next [J] : -\/1)}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00005}00005 \textcolor{keyword}{static} \textcolor{keywordtype}{void} init\_ata (\mbox{\hyperlink{structcs__sparse}{cs}} *AT, \textcolor{keyword}{const} \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} *post, \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} *w, \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} **head, \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} **next)}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00006}00006 \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00007}00007     \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}, k, p, m = AT-\/>\mbox{\hyperlink{structcs__sparse_ad9d0192b240c4ea51984ad0d09f56a02}{n}}, n = AT-\/>\mbox{\hyperlink{structcs__sparse_a8dab81f7d781bd65c7cb4f103db87ade}{m}}, *ATp = AT-\/>\mbox{\hyperlink{structcs__sparse_a645e83714f71e7ab788ee75c6fc46dac}{p}}, *ATi = AT-\/>\mbox{\hyperlink{structcs__sparse_a95cad038b1ec034f444ab517822040b1}{i}} ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00008}00008     *head = w+4*n, *next = w+5*n+1 ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00009}00009     \textcolor{keywordflow}{for} (k = 0 ; k < n ; k++) w [post [k]] = k ;    \textcolor{comment}{/* invert post */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00010}00010     \textcolor{keywordflow}{for} (\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} = 0 ; \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} < m ; \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}++)}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00011}00011     \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00012}00012         \textcolor{keywordflow}{for} (k = n, p = ATp[\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}] ; p < ATp[\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}+1] ; p++) k = \mbox{\hyperlink{cs_8h_a2635aa5c35f05bb0e4c88be5aabae949}{CS\_MIN}} (k, w [ATi[p]]);}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00013}00013         (*next) [\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}] = (*head) [k] ;     \textcolor{comment}{/* place row i in linked list k */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00014}00014         (*head) [k] = \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00015}00015     \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00017}\mbox{\hyperlink{cs_8h_ad97e14775c7d6b9f8f1e8c5ee0d63aa7}{00017}} \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} *\mbox{\hyperlink{cs__counts_8c_ad97e14775c7d6b9f8f1e8c5ee0d63aa7}{cs\_counts}} (\textcolor{keyword}{const} \mbox{\hyperlink{structcs__sparse}{cs}} *A, \textcolor{keyword}{const} \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} *parent, \textcolor{keyword}{const} \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} *post, \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} ata)}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00018}00018 \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00019}00019     \mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}} \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}, j, k, n, m, J, s, p, q, jleaf, *ATp, *ATi, *maxfirst, *prevleaf,}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00020}00020         *ancestor, *head = NULL, *next = NULL, *colcount, *w, *first, *delta ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00021}00021     \mbox{\hyperlink{structcs__sparse}{cs}} *AT ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00022}00022     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{cs_8h_a11fc95c9740a561d409f89b987d8072f}{CS\_CSC}} (A) || !parent || !post) \textcolor{keywordflow}{return} (NULL) ;    \textcolor{comment}{/* check inputs */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00023}00023     m = A-\/>\mbox{\hyperlink{structcs__sparse_a8dab81f7d781bd65c7cb4f103db87ade}{m}} ; n = A-\/>\mbox{\hyperlink{structcs__sparse_ad9d0192b240c4ea51984ad0d09f56a02}{n}} ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00024}00024     s = 4*n + (ata ? (n+m+1) : 0) ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00025}00025     delta = colcount = \mbox{\hyperlink{cs_8h_aeaf304feeab73b22eed3e64c0371884b}{cs\_malloc}} (n, \textcolor{keyword}{sizeof} (\mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}})) ;    \textcolor{comment}{/* allocate result */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00026}00026     w = \mbox{\hyperlink{cs_8h_aeaf304feeab73b22eed3e64c0371884b}{cs\_malloc}} (s, \textcolor{keyword}{sizeof} (\mbox{\hyperlink{cs_8h_a95c7aeda659645c4dbdb55da86fddcc0}{csi}})) ;                   \textcolor{comment}{/* get workspace */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00027}00027     AT = \mbox{\hyperlink{cs_8h_a838dfaabdae54c408a4a696dfffa3dea}{cs\_transpose}} (A, 0) ;                          \textcolor{comment}{/* AT = A' */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00028}00028     \textcolor{keywordflow}{if} (!AT || !colcount || !w) \textcolor{keywordflow}{return} (\mbox{\hyperlink{cs_8h_a5f172de9436558173ef0b873d9e1a5db}{cs\_idone}} (colcount, AT, w, 0)) ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00029}00029     ancestor = w ; maxfirst = w+n ; prevleaf = w+2*n ; first = w+3*n ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00030}00030     \textcolor{keywordflow}{for} (k = 0 ; k < s ; k++) w [k] = -\/1 ;      \textcolor{comment}{/* clear workspace w [0..s-\/1] */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00031}00031     \textcolor{keywordflow}{for} (k = 0 ; k < n ; k++)                   \textcolor{comment}{/* find first [j] */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00032}00032     \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00033}00033         j = post [k] ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00034}00034         delta [j] = (first [j] == -\/1) ? 1 : 0 ;  \textcolor{comment}{/* delta[j]=1 if j is a leaf */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00035}00035         \textcolor{keywordflow}{for} ( ; j != -\/1 \&\& first [j] == -\/1 ; j = parent [j]) first [j] = k ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00036}00036     \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00037}00037     ATp = AT-\/>\mbox{\hyperlink{structcs__sparse_a645e83714f71e7ab788ee75c6fc46dac}{p}} ; ATi = AT-\/>\mbox{\hyperlink{structcs__sparse_a95cad038b1ec034f444ab517822040b1}{i}} ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00038}00038     \textcolor{keywordflow}{if} (ata) init\_ata (AT, post, w, \&head, \&next) ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00039}00039     \textcolor{keywordflow}{for} (\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} = 0 ; \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} < n ; \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}++) ancestor [\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}] = \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} ; \textcolor{comment}{/* each node in its own set */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00040}00040     \textcolor{keywordflow}{for} (k = 0 ; k < n ; k++)}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00041}00041     \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00042}00042         j = post [k] ;          \textcolor{comment}{/* j is the kth node in postordered etree */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00043}00043         \textcolor{keywordflow}{if} (parent [j] != -\/1) delta [parent [j]]-\/-\/ ;    \textcolor{comment}{/* j is not a root */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00044}00044         \textcolor{keywordflow}{for} (J = \mbox{\hyperlink{cs__counts_8c_a12ca900356d8c2b441db5f1077dee0e8}{HEAD}} (k,j) ; J != -\/1 ; J = \mbox{\hyperlink{cs__counts_8c_a5638f1bcf2b9b270aa560e0ec861b133}{NEXT}} (J))   \textcolor{comment}{/* J=j for LL'=A case */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00045}00045         \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00046}00046             \textcolor{keywordflow}{for} (p = ATp [J] ; p < ATp [J+1] ; p++)}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00047}00047             \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00048}00048                 \mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}} = ATi [p] ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00049}00049                 q = \mbox{\hyperlink{cs_8h_aaeedf973ec2de811ead0e47f8501a81d}{cs\_leaf}} (\mbox{\hyperlink{make__abip__qcp_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}, j, first, maxfirst, prevleaf, ancestor, \&jleaf);}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00050}00050                 \textcolor{keywordflow}{if} (jleaf >= 1) delta [j]++ ;   \textcolor{comment}{/* A(i,j) is in skeleton */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00051}00051                 \textcolor{keywordflow}{if} (jleaf == 2) delta [q]-\/-\/ ;   \textcolor{comment}{/* account for overlap in q */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00052}00052             \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00053}00053         \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00054}00054         \textcolor{keywordflow}{if} (parent [j] != -\/1) ancestor [j] = parent [j] ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00055}00055     \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00056}00056     \textcolor{keywordflow}{for} (j = 0 ; j < n ; j++)           \textcolor{comment}{/* sum up delta's of each child */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00057}00057     \{}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00058}00058         \textcolor{keywordflow}{if} (parent [j] != -\/1) colcount [parent [j]] += colcount [j] ;}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00059}00059     \}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00060}00060     \textcolor{keywordflow}{return} (\mbox{\hyperlink{cs_8h_a5f172de9436558173ef0b873d9e1a5db}{cs\_idone}} (colcount, AT, w, 1)) ;    \textcolor{comment}{/* success: free workspace */}}
\DoxyCodeLine{\Hypertarget{cs__counts_8c_source_l00061}00061 \} }

\end{DoxyCode}
